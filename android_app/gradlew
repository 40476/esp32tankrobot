#!/bin/bash
if [ -z "$JAVA_HOME" ]; then
    JAVA_BIN=$(which java 2>/dev/null)
    if [ -n "$JAVA_BIN" ]; then
        JAVA_HOME=$(dirname $(dirname "$JAVA_BIN"))
    fi
fi
GRADLE_USER_HOME="${GRADLE_USER_HOME:-$HOME/.gradle}"
DIST_URL=$(grep '^distributionUrl=' gradle/wrapper/gradle-wrapper.properties | cut -d= -f2- | sed 's/\\:/:/g')
GRADLE_VERSION=$(echo "$DIST_URL" | grep -o '[0-9]*\.[0-9]*\.[0-9]*')
WRAPPER_JAR="$GRADLE_USER_HOME/wrapper/dists/gradle-$GRADLE_VERSION-bin/$GRADLE_VERSION/gradle-wrapper.jar"
if [ ! -f "$WRAPPER_JAR" ]; then
    echo "Downloading Gradle $GRADLE_VERSION..."
    mkdir -p "$(dirname "$WRAPPER_JAR")"
    curl -s -L -o "$WRAPPER_JAR" "$DIST_URL" || {
        echo "Failed to download Gradle"
        exit 1
    }
fi
exec "$JAVA_HOME/bin/java" -jar "$WRAPPER_JAR" "$@"
